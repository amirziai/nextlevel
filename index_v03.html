<html>
	<head>
		<title>NextLevel</title>
		<script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

		<!-- <script type="text/javascript" src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
		<link rel="stylesheet" src="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css"> -->

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">


		<script type="text/javascript">
			function getParameterByName(name, url) {
			    if (!url) url = window.location.href;
			    name = name.replace(/[\[\]]/g, "\\$&");
			    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
			        results = regex.exec(url);
			    if (!results) return null;
			    if (!results[2]) return '';
			    return decodeURIComponent(results[2].replace(/\+/g, " "));
			}

			Array.prototype.min = function() {
			  return Math.min.apply(null, this);
			};

			Array.prototype.max = function() {
			  return Math.max.apply(null, this);
			};

			String.prototype.capitalize = function() {
			    return this.charAt(0).toUpperCase() + this.slice(1);
			}

			function step(step) {
				if (step == 1) {
					$("#step1").hide();
					$("#step2").show();
				}
				else{

				}
			}

			belts = {
				1: 'white',
				2: 'yellow',
				3: 'orange',
				4: 'blue',
				5: 'purple',
				6: 'brown',
				7: 'black'
			}

			movements = ['deadlift', 'front squat', 'running', 'fran'];

			function buildRow(row_text, score) {
				score_int = Math.floor(score);

				x = '<tr><td style="width:150px; padding: 2px; vertical-align: top">' + row_text + '</td>';

				for (i in belts) {
					if (score_int > i) {
						background_color = belts[i];
						x += '<td style="border:3px solid black; background-color: ' + background_color + '; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>';
					}
					else if (score_int == i) {
						background_color = belts[score_int];
						if ($.inArray(background_color, ['blue', 'purple', 'brown', 'black']) >= 0) {
							color = 'white';
						}
						else {
							color = 'black';
						}

						value = Math.round(10 * (score - score_int));
						x += '<td style="border:3px solid black; background-color: ' + background_color + '; padding: 2px; color: ' + color + '">&nbsp;' + (value == 0 ? '&nbsp;' : value) + '&nbsp;</td>';
					}
					else {
						x += '<td style="border:2px dotted black; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>';
					}
				}

				x += '<td style="border:0"><small>&nbsp;<a href="#">Details</a></small></td></tr>';  // TODO: fix

				$("#tbl").append(x);
			}

			function buildRowNextLevel(data, belt, entry) {
				stripe = Math.round(10 * (belt - Math.floor(belt))) ;
				txt = '';
				// txt2 = '';

				if (belt == 7) {
					// txt = "&nbsp;";
					txt = 'Congrats! You are now a black belt! ';
				}
				else {
					c = 0;

					for (datum in data) {
						// console.log(data[datum]);
						val = data[datum];
						if (val == belt && val < 7) {
							txt += 'Work on ' + movements[c] + '<br>';
						}

						c += 1;
					}
				}

				
				// if (belt == 0) {
				// 	if (entry == 0) {
				// 		txt2 = 'Log your first entry';
				// 	}
				// 	else {
				// 		txt2 = 'Get your first belt';
				// 	}
				// }
				// else if (belt < 7) {
				// 	if (stripe == 3) {
				// 		txt2 = belts[Math.ceil(belt)].capitalize();
				// 	}
				// 	else {
				// 		txt2 = belts[Math.floor(belt)].capitalize() + ' ' + (stripe + 1);
				// 	}
				// }
				

				x = '<tr><td colspan="9">&nbsp;</td></tr><tr><td style="vertical-align: top; padding: 2px">Next level</td><td colspan="8" style="vertical-align: top; padding: 2px">' + txt + '</td></tr>';

				$("#tbl").append(x);
			}

			
			$(document).ready(function (e) {
				$.ajax({
		            url: "/user/" + getParameterByName('user'),
		            //url: "http://localhost:5000/user/" + getParameterByName('user'),
		            type: "GET",
		            dataType:'json',
		            success: function(data){

		            	name = data['user']['name'];
		            	gender = data['user']['gender'];
		            	data = data['user']['data'];
		            	belt = data.min();
		            	entry = data.max();

		            	$("#name").text(name);

		            	msg = '';
		            	if (entry == 0) {
		            		msg = 'You have not logged anything yet';
		            	}
		            	else if (belt == 0) {
		            		msg = 'Get your first belt';
		            	}
		            	else{
		            		msg = 'You are a ' + belts[Math.floor(belt)]  + ' belt';
		            	}

		            	colors = ['white', 'yellow', 'orange', 'blue', 'purple', 'brown', 'black'];

		            	buildRow('Current level', belt);
		            	buildRowNextLevel(data, belt, entry);


		            	// xx = '';
		            	// for (i in colors) {
		            	// 	x = '<i class="fa fa-' + (belt == colors[i] ? 'check-' : '') + 'square-o fa-3x" style="color:' + colors[i] + '"></i>&nbsp;';
		            	// 	xx += x;
		            	// }

		            	// $("#belt").html(xx);
		            	// $("#msg").text(msg);


		            	// $("#af").show();
		            	// // static info
		            	// $("#fc_extra").text(cost_fullcontact);
		            	// $("#cb_extra").text(cost_clearbit);

		            	// remaining_clearbit = parseInt(data['remaining_clearbit']);
		            	// remaining_fullcontact = parseInt(data['remaining_fullcontact']);

		            	// $("#fc_remaining").text(remaining_fullcontact);
		            	// // TODO: cb remaining

		            	// var i = 0;
		            	// for (var a in data['results']){
		            	// 	x = data['results'][a];
		            	// 	email_found = parseInt(x['emails']) > 0;
		            	// 	rows = parseInt(x['rows']);
		            	// 	local_found = 0;
		            	// 	btn = 'N/A';

		            	// 	local = (x['next_step'] == 'local' ? true : false);

		            	// 	cost = calculate_cost(rows, remaining_fullcontact, remaining_clearbit);
		            	// 	quality = '?';
		            	// 	dataset = x['dataset'];
		            		

		            	// 	if (email_found) {
		            	// 		if (local) {
		            	// 			cost = 0;
		            	// 			btn = '<button type="button" class="btn btn-default btn-sm">Local</button>';
		            	// 		}
		            	// 		else{
		            	// 			local_found = parseInt(x['local_found']);
		            	// 			txt = 'local records: ' + local_found + ', conservative estimate: $' + cost;
		            	// 			btn = '<button type="button" class="btn btn-primary btn-sm" id="tooltip' + i + '" data-placement="left" title="' + txt + '">&nbsp;Full&nbsp;</button>';
		            	// 			cost = calculate_cost(rows - local_found, remaining_fullcontact, remaining_clearbit);
		            	// 			quality = (100 * parseFloat(x['matched_complete'])).toFixed(0) + '%';
		            	// 			dataset = '<a target="_blank" href="https://api.accessfuel.com/engine/audience.html?job=' + x['job'] + '">' + dataset + '</a>';
		            	// 		}
		            	// 	}

		            	// 	time = Math.max(((local ? 0.1 : 1) * (rows - local_found) / 60 ).toFixed(0), 0);

		            	// 	html = '<tr><td>' + x['timestamp'] + '</td><td>[need client]</td><td>' + dataset + '</td><td>' + rows + '</td><td>' + x['attributes'] + '</td><td>' + x['matched'] + '</td><td>' + (email_found ? 'Yes':'No') + '</td><td>' + quality + '</td><td>$' + cost + '</td><td>' + time + '</td><td>' + btn + '</td></tr>';
		            	// 	$("#tbl tbody").append(html);

		            	// 	i += 1;
		            	// }

		            	// $('#tbl').DataTable({
		            	// 	'order': [[0, 'desc']]
		            	// });
		            }           
		       });  
			});

		</script>
	</head>

	<body>
		<div class="container">
<!-- 		<div class="row">
			<div class="col-md-2"></div>
			<div class="col-md-8"> -->
			<br>
			<br>
			<div class="jumbotron">
				<img src="http://nextlevelwp.buckplace.com/wp-content/uploads/2014/01/logonumber.png" style="width:350px">
				<br>
				<br>
				<div id="step1">
					<h1>Hello, <span id="name"></span>!</h1>

					<br>
					<table style="border-spacing: 2px" id="tbl">
						<!-- <tr>
							<td style="width:150px; padding: 2px; vertical-align: top">Current level</td>
							<td style="border:3px solid black; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>
							<td style="border:3px solid black; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>
							<td style="border:3px solid black; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>
							<td style="border:3px solid black; background-color: blue; padding: 2px; color: white">&nbsp;2&nbsp;</td>
							<td style="border:2px dotted purple; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>
							<td style="border:2px dotted brown; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>
							<td style="border:2px dotted black; width: 20px; padding: 2px">&nbsp;&nbsp;&nbsp;</td>
							<td style="border:0"><small>&nbsp;<a href="#">Details</a></small></td>
						</tr> -->
					</table>
					<br>
					<p><a class="btn btn-primary btn-lg" href="#" role="button" onclick="step(1)">Log an entry</a></p>

					<p id="msg"></p>

					<p id="belt"></p>
				</div>

				<div id="step2" style="display: none">
					<p>Pick the test:</p>
					<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
					  <div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingOne">
					      <h4 class="panel-title">
					        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
					          Deadlift
					        </a>
					      </h4>
					    </div>
					    <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
					      <div class="panel-body">
					        <table class="table table-hover table-condensed">
					        	<tr>
					        		<td style="background-color:yellow">&nbsp;</td>
					        		<td>Yellow</td>
					        		<td>12 reps @ 72lbs</td>
					        		<td>
					        			<button type="button" class="btn btn-primary">Select</button>
					        		</td>
					        	</tr>
					        	<tr>
					        		<td style="background-color:yellow">&nbsp;</td>
					        		<td>I</td>
					        		<td>12 reps @ 105lbs</td>
					        		<td>
					        			<button type="button" class="btn btn-primary">Select</button>
					        		</td>
					        	</tr>
					        	<tr>
					        		<td style="background-color:yellow">&nbsp;</td>
					        		<td>II</td>
					        		<td>8 reps @ 145lbs</td>
					        		<td>
					        			<button type="button" class="btn btn-primary">Select</button>
					        		</td>
					        	</tr>
					        	<tr>
					        		<td style="background-color:yellow">&nbsp;</td>
					        		<td>III</td>
					        		<td>8 reps @ 185lbs</td>
					        		<td>
					        			<button type="button" class="btn btn-primary">Select</button>
					        		</td>
					        	</tr>
					        	<tr>
					        		<td style="background-color:blue">&nbsp;</td>
					        		<td>Blue</td>
					        		<td>1 rep @ 400lbs</td>
					        		<td>
					        			<button type="button" class="btn btn-primary">Select</button>
					        		</td>
					        	</tr>
					        </table>
					      </div>
					    </div>
					  </div>
					  <div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingTwo">
					      <h4 class="panel-title">
					        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
					          Front squat
					        </a>
					      </h4>
					    </div>
					    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
					      <div class="panel-body">
					        Y.
					      </div>
					    </div>
					  </div>
					  <div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingThree">
					      <h4 class="panel-title">
					        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
					          Running
					        </a>
					      </h4>
					    </div>
					    <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
					      <div class="panel-body">
					        Z.
					      </div>
					    </div>
					  </div>
					  <div class="panel panel-default">
					    <div class="panel-heading" role="tab" id="headingFour">
					      <h4 class="panel-title">
					        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
					          Fran
					        </a>
					      </h4>
					    </div>
					    <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
					      <div class="panel-body">
					        Zzzz.
					      </div>
					    </div>
					  </div>
					</div>
				</div>
			</div>
<!-- 			</div>
			<div class="col-md-2"></div>
		</div> -->
		</div>
	</body>
</html>
